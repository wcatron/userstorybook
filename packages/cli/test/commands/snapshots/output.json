[
    {
        "fileName": "createUser.ts",
        "name": "createUser",
        "namePretty": "Create user",
        "code": "function (\n  { name, roles = [] },\n  { auth, datasources: { userRespository } }\n) {\n  if (!auth?.roles.includes(\"admin\")) {\n    throw new Error(\"Improper role for creating a new user\");\n  }\n  const user = userRespository.create(name, [\"user\"]);\n  if (\n    isOnTheAdminList(auth.id) &&\n    roles.includes(\"admin\") &&\n    isOnTheAdminList(user.name)\n  ) {\n    user.roles.push(\"admin\");\n  }\n  return user;\n}",
        "returns": [
            {
                "name": "name",
                "type": "string",
                "children": []
            },
            {
                "name": "id",
                "type": "string",
                "children": []
            },
            {
                "name": "roles",
                "type": "AuthRoles[]",
                "children": []
            }
        ],
        "inputs": [
            {
                "name": "name",
                "type": "string",
                "children": []
            },
            {
                "name": "roles",
                "type": "string[]",
                "children": []
            }
        ],
        "context": [
            {
                "name": "auth",
                "type": "AuthContext",
                "children": [
                    {
                        "name": "id",
                        "type": "string",
                        "children": []
                    },
                    {
                        "name": "roles",
                        "type": "AuthRoles[]",
                        "children": []
                    }
                ]
            },
            {
                "name": "datasources",
                "type": "{ userRespository: UserRepository; }",
                "children": [
                    {
                        "name": "userRespository",
                        "type": "UserRepository",
                        "children": [
                            {
                                "name": "get",
                                "type": "(id: string) => User",
                                "children": []
                            },
                            {
                                "name": "create",
                                "type": "(name: string, roles: AuthRoles[]) => User",
                                "children": []
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "fileName": "getUser.ts",
        "name": "getUser",
        "namePretty": "Get user",
        "code": "function ({ id }, { datasources: { userRespository }, auth }) {\n  const isAdmin = auth?.roles.includes(\"admin\");\n  const belongsToUser = id == auth?.id;\n  if (id && (isAdmin || belongsToUser)) {\n    return userRespository.get(id);\n  } else if (auth?.id) {\n    return userRespository.get(auth.id);\n  } else {\n    throw new Error(\"Missing id or authenticated context required to get user\");\n  }\n}",
        "returns": [
            {
                "name": "name",
                "type": "string",
                "children": []
            },
            {
                "name": "id",
                "type": "string",
                "children": []
            },
            {
                "name": "roles",
                "type": "AuthRoles[]",
                "children": []
            }
        ],
        "inputs": [
            {
                "name": "id",
                "type": "string",
                "children": []
            }
        ],
        "context": [
            {
                "name": "auth",
                "type": "AuthContext",
                "children": [
                    {
                        "name": "id",
                        "type": "string",
                        "children": []
                    },
                    {
                        "name": "roles",
                        "type": "AuthRoles[]",
                        "children": []
                    }
                ]
            },
            {
                "name": "datasources",
                "type": "{ userRespository: UserRepository; }",
                "children": [
                    {
                        "name": "userRespository",
                        "type": "UserRepository",
                        "children": [
                            {
                                "name": "get",
                                "type": "(id: string) => User",
                                "children": []
                            },
                            {
                                "name": "create",
                                "type": "(name: string, roles: AuthRoles[]) => User",
                                "children": []
                            }
                        ]
                    }
                ]
            }
        ]
    }
]